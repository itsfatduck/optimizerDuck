<Page
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Margin="0,32,0,0"
    ScrollViewer.CanContentScroll="False"
    Title="StartupManagerPage"
    d:DataContext="{d:DesignInstance local:StartupManagerPage}"
    d:DesignHeight="1200"
    d:DesignWidth="800"
    mc:Ignorable="d"
    ui:Design.Background="Black"
    ui:Design.Foreground="White"
    x:Class="optimizerDuck.UI.Views.Pages.StartupManagerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:converters="clr-namespace:optimizerDuck.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="clr-namespace:optimizerDuck.Common.Extensions"
    xmlns:local="clr-namespace:optimizerDuck.UI.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:optimizerDuck.Core.Models.StartupManager"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter" />
    </Page.Resources>

    <Grid RowDefinitions="Auto, *">
        <!--  Header  -->
        <StackPanel Margin="0,0,0,20">
            <ui:TextBlock FontTypography="Title" Text="{ext:Loc StartupManager.Header.Title}" />
            <ui:TextBlock
                Appearance="Secondary"
                FontTypography="Body"
                Margin="0,4,0,0"
                Text="{ext:Loc StartupManager.Header.Description}"
                TextWrapping="Wrap" />
        </StackPanel>

        <!--  Loading Indicator  -->
        <Border Grid.Row="1" Visibility="{Binding ViewModel.IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:ProgressRing
                    Height="48"
                    HorizontalAlignment="Center"
                    IsIndeterminate="True"
                    Margin="0,0,0,16"
                    VerticalAlignment="Center"
                    Width="48" />
                <ui:TextBlock
                    FontTypography="BodyStrong"
                    HorizontalAlignment="Center"
                    Text="{ext:Loc StartupManager.Loading}" />
                <ui:TextBlock
                    Appearance="Secondary"
                    FontTypography="Caption"
                    HorizontalAlignment="Center"
                    Margin="0,4,0,0"
                    Text="{ext:Loc StartupManager.Loading.Hint}" />
            </StackPanel>
        </Border>

        <!--  Empty State (no data at all)  -->
        <Border Grid.Row="1">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed" />
                    <Style.Triggers>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ViewModel.HasData}" Value="False" />
                                <Condition Binding="{Binding ViewModel.IsLoading}" Value="False" />
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Visibility" Value="Visible" />
                        </MultiDataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:SymbolIcon
                    FontSize="46"
                    Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,15"
                    Symbol="AppGeneric24" />
                <ui:TextBlock
                    FontTypography="Subtitle"
                    HorizontalAlignment="Center"
                    Text="{ext:Loc StartupManager.Empty.Title}" />
                <ui:TextBlock
                    Appearance="Secondary"
                    FontTypography="Body"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,10"
                    Text="{ext:Loc StartupManager.Empty.Description}" />
                <ui:Button
                    Appearance="Primary"
                    Command="{Binding ViewModel.RefreshCommand}"
                    Content="{ext:Loc StartupManager.Menu.Refresh}"
                    HorizontalAlignment="Center"
                    Icon="{ui:SymbolIcon ArrowClockwise24,
                                         FontSize=18}" />
            </StackPanel>
        </Border>

        <!--  Main Content  -->
        <Border Grid.Row="1" Visibility="{Binding ViewModel.HasData, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid RowDefinitions="Auto,*">
                <!--  Toolbar  -->
                <WrapPanel
                    Grid.Row="0"
                    Margin="0,0,0,12"
                    Orientation="Horizontal">
                    <!--  Search  -->
                    <ui:TextBox
                        Icon="{ui:SymbolIcon Search24}"
                        Margin="0,0,8,0"
                        MinWidth="220"
                        PlaceholderText="{ext:Loc Common.Search.Placeholder}"
                        Text="{Binding ViewModel.SearchText, UpdateSourceTrigger=PropertyChanged}"
                        VerticalAlignment="Center" />

                    <ui:Button
                        Appearance="Primary"
                        Command="{Binding ViewModel.RefreshCommand}"
                        Content="{ext:Loc StartupManager.Menu.Refresh}"
                        Icon="{ui:SymbolIcon ArrowClockwise24,
                                             FontSize=18}" />
                </WrapPanel>

                <!--  Scrollable content  -->
                <ScrollViewer Grid.Row="1" Margin="0,0,16,0">
                    <StackPanel>
                        <!--  Startup Apps Section  -->
                        <ui:CardExpander
                            Icon="{ui:SymbolIcon Apps24}"
                            IsExpanded="True"
                            Margin="0,0,0,12"
                            Visibility="{Binding ViewModel.Apps.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel Orientation="Horizontal">
                                    <ui:TextBlock
                                        FontTypography="BodyStrong"
                                        Text="{ext:Loc StartupManager.Apps.Title}"
                                        VerticalAlignment="Center" />
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="10"
                                        Margin="8,0,0,0"
                                        Padding="8,2"
                                        VerticalAlignment="Center">
                                        <ui:TextBlock
                                            Appearance="Tertiary"
                                            FontTypography="Caption"
                                            Text="{Binding ViewModel.Apps.Count}"
                                            VerticalAlignment="Center" />
                                    </Border>
                                </StackPanel>
                            </ui:CardExpander.Header>

                            <ItemsControl ItemsSource="{Binding ViewModel.Apps}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type models:StartupApp}">
                                        <Grid>
                                            <ui:CardAction
                                                Command="{Binding DataContext.ViewModel.OpenLocationCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding}"
                                                IsChevronVisible="False"
                                                Margin="0,0,0,4"
                                                Padding="12,10"
                                                x:Name="ActionCard">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Image
                                                        Grid.Column="0"
                                                        Height="36"
                                                        Margin="0,0,12,0"
                                                        Source="{Binding LogoImage}"
                                                        Stretch="UniformToFill"
                                                        VerticalAlignment="Center"
                                                        Width="36" />
                                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                        <DockPanel LastChildFill="False">
                                                            <ui:TextBlock FontTypography="BodyStrong" Text="{Binding Name}" />
                                                            <Border
                                                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                                                CornerRadius="4"
                                                                Margin="8,0,0,0"
                                                                Padding="6,1"
                                                                VerticalAlignment="Center">
                                                                <ui:TextBlock
                                                                    Appearance="Tertiary"
                                                                    FontTypography="Caption"
                                                                    Text="{Binding LocationDisplay}"
                                                                    VerticalAlignment="Center" />
                                                            </Border>
                                                        </DockPanel>
                                                        <ui:TextBlock
                                                            Appearance="Secondary"
                                                            FontTypography="Caption"
                                                            Margin="0,2,0,0"
                                                            Text="{Binding Publisher}" />
                                                        <ui:TextBlock
                                                            Appearance="Disabled"
                                                            FontTypography="Caption"
                                                            Margin="0,2,0,0"
                                                            Text="{Binding Command}"
                                                            TextTrimming="CharacterEllipsis" />
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                        <ui:ToggleSwitch
                                                            IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                                            Margin="0,0,16,0"
                                                            VerticalAlignment="Center" />
                                                        <ui:SymbolIcon FontSize="16" Symbol="Open24" />
                                                    </StackPanel>
                                                </Grid>
                                            </ui:CardAction>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ui:CardExpander>

                        <!--  Scheduled Tasks Section  -->
                        <ui:CardExpander
                            Icon="{ui:SymbolIcon TaskListLtr24}"
                            IsExpanded="True"
                            Margin="0,0,0,12"
                            Visibility="{Binding ViewModel.Tasks.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel Orientation="Horizontal">
                                    <ui:TextBlock
                                        FontTypography="BodyStrong"
                                        Text="{ext:Loc StartupManager.Tasks.Title}"
                                        VerticalAlignment="Center" />
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="10"
                                        Margin="8,0,0,0"
                                        Padding="8,2"
                                        VerticalAlignment="Center">
                                        <ui:TextBlock
                                            Appearance="Tertiary"
                                            FontTypography="Caption"
                                            Text="{Binding ViewModel.Tasks.Count}"
                                            VerticalAlignment="Center" />
                                    </Border>
                                </StackPanel>
                            </ui:CardExpander.Header>

                            <ItemsControl ItemsSource="{Binding ViewModel.Tasks}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type models:StartupTask}">
                                        <Border
                                            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                            CornerRadius="6"
                                            Margin="0,0,0,4"
                                            Padding="12,10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel
                                                    Grid.Column="0"
                                                    Margin="0,0,12,0"
                                                    VerticalAlignment="Center">
                                                    <ui:TextBlock FontTypography="BodyStrong" Text="{Binding TaskName}" />
                                                    <ui:TextBlock
                                                        Appearance="Secondary"
                                                        FontTypography="Caption"
                                                        Margin="0,2,0,0"
                                                        Text="{Binding Description}"
                                                        TextWrapping="Wrap" />
                                                    <ui:TextBlock
                                                        Appearance="Disabled"
                                                        FontTypography="Caption"
                                                        Margin="0,2,0,0"
                                                        Text="{Binding TaskPath}" />
                                                </StackPanel>

                                                <ui:ToggleSwitch
                                                    Grid.Column="1"
                                                    IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                                    VerticalAlignment="Center" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ui:CardExpander>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Page>