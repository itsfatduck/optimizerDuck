<Page
    x:Class="optimizerDuck.UI.Views.Pages.DiskCleanupPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cleanup="clr-namespace:optimizerDuck.Core.Models.Cleanup"
    xmlns:converters="clr-namespace:optimizerDuck.Common.Helpers.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="clr-namespace:optimizerDuck.Common.Extensions"
    xmlns:local="clr-namespace:optimizerDuck.UI.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="DiskCleanupPage"
    Margin="0,32,0,0"
    d:DataContext="{d:DesignInstance local:DiskCleanupPage}"
    d:DesignHeight="1200"
    d:DesignWidth="800"
    ui:Design.Background="Black"
    ui:Design.Foreground="White"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    ScrollViewer.CanContentScroll="False"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:SizeToBrushConverter x:Key="SizeToBrushConverter" />
    </Page.Resources>

    <Grid RowDefinitions="Auto *">
        <!--  Header  -->
        <StackPanel Margin="0,0,0,20">
            <ui:TextBlock
                FontTypography="Title"
                Text="{ext:Loc DiskCleanup.Header.Title}"
                TextWrapping="Wrap" />
            <ui:TextBlock
                Margin="0,4,0,0"
                Appearance="Secondary"
                FontTypography="Body"
                Text="{ext:Loc DiskCleanup.Header.Description}"
                TextWrapping="Wrap" />
        </StackPanel>

        <!--  Loading state (initial scan)  -->
        <Border Grid.Row="1" Visibility="{Binding ViewModel.IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Orientation="Vertical">
                <ui:SymbolIcon
                    Margin="0,0,0,16"
                    HorizontalAlignment="Center"
                    FontSize="48"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Symbol="HardDrive20" />
                <ui:ProgressRing
                    Width="36"
                    Height="36"
                    Margin="0,0,0,12"
                    HorizontalAlignment="Center"
                    IsIndeterminate="True" />
                <ui:TextBlock
                    HorizontalAlignment="Center"
                    FontTypography="BodyStrong"
                    Text="{ext:Loc DiskCleanup.Loading}" />
                <ui:TextBlock
                    Margin="0,4,0,0"
                    HorizontalAlignment="Center"
                    Appearance="Secondary"
                    FontTypography="Caption"
                    Text="{ext:Loc DiskCleanup.Header.Description}" />
            </StackPanel>
        </Border>

        <!--  Main content  -->
        <Grid
            Grid.Row="1"
            RowDefinitions="Auto,Auto,Auto,*"
            Visibility="{Binding ViewModel.HasData, Converter={StaticResource BooleanToVisibilityConverter}}">

            <!--  Summary card  -->
            <Border
                Margin="0,0,0,12"
                Padding="16"
                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                CornerRadius="8">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!--  Icon  -->
                    <Border
                        Width="44"
                        Height="44"
                        Margin="0,0,16,0"
                        VerticalAlignment="Center"
                        CornerRadius="22">
                        <ui:SymbolIcon
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontSize="22"
                            Symbol="HardDrive20" />
                    </Border>

                    <!--  Info  -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <ui:TextBlock FontTypography="BodyStrong" Text="{ext:Loc DiskCleanup.TotalSpace}" />
                        <ui:TextBlock
                            Margin="0,2,0,0"
                            Appearance="Secondary"
                            FontTypography="Body"
                            Text="{ext:Loc DiskCleanup_ItemsAndFilesSelected,
                                           {Binding ViewModel.TotalSelectedSizeFormatted},
                                           {Binding ViewModel.SelectedCount},
                                           {Binding ViewModel.TotalSelectedFileCount}}" />
                    </StackPanel>

                    <!--  Scanning indicator in summary  -->
                    <StackPanel
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Visibility="{Binding ViewModel.IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ui:ProgressRing
                            Width="16"
                            Height="16"
                            Margin="0,0,8,0"
                            IsIndeterminate="True" />
                        <ui:TextBlock
                            VerticalAlignment="Center"
                            Appearance="Secondary"
                            FontTypography="Caption"
                            Text="{ext:Loc DiskCleanup.Scanning}" />
                    </StackPanel>
                </Grid>
            </Border>

            <!--  Sort toolbar  -->
            <WrapPanel
                Grid.Row="1"
                Margin="0,0,0,8"
                Orientation="Horizontal">

                <!--  Sort By  -->
                <ComboBox
                    Margin="0,0,8,0"
                    SelectedIndex="{Binding ViewModel.SelectedSortByIndex}"
                    ToolTip="{ext:Loc Common.SortBy}"
                    ToolTipService.BetweenShowDelay="160"
                    ToolTipService.Placement="Top"
                    VerticalAlignment="Center">
                    <ComboBoxItem Content="{ext:Loc Common.SortBy.Default}" />
                    <ComboBoxItem Content="{ext:Loc Common.SortBy.Size}" />
                    <ComboBoxItem Content="{ext:Loc Common.SortBy.Name}" />
                    <ComboBoxItem Content="{ext:Loc Common.SortBy.Path}" />
                </ComboBox>
            </WrapPanel>

            <!--  Action buttons  -->
            <StackPanel
                Grid.Row="2"
                Margin="0,0,0,12"
                Orientation="Horizontal">

                <!--  Scan button  -->
                <ui:Button
                    Appearance="Primary"
                    Command="{Binding ViewModel.ScanCommand}"
                    Content="{ext:Loc DiskCleanup.Button.Scan}"
                    Icon="{ui:SymbolIcon Search24,
                                         FontSize=18}"
                    IsEnabled="{Binding ViewModel.IsScanning, Converter={StaticResource InverseBooleanConverter}}" />

                <Separator Margin="4,0,4,0" />

                <!--  Clean button  -->
                <ui:Button
                    Appearance="Danger"
                    Command="{Binding ViewModel.CleanSelectedCommand}"
                    IsEnabled="{Binding ViewModel.CanClean}">
                    <ui:Button.Content>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon
                                Margin="0,0,6,0"
                                FontSize="18"
                                Symbol="Delete24" />
                            <TextBlock Text="{ext:Loc DiskCleanup.Button.CleanSelected, {Binding ViewModel.TotalSelectedSizeFormatted}}" />
                        </StackPanel>
                    </ui:Button.Content>
                </ui:Button>

                <Separator Margin="4,0,4,0" />

                <!--  Select/Deselect All  -->
                <ui:Button Command="{Binding ViewModel.SelectAllCommand}">
                    <ui:Button.Style>
                        <Style BasedOn="{StaticResource {x:Type ui:Button}}" TargetType="ui:Button">
                            <Setter Property="Appearance" Value="Success" />
                            <Setter Property="Content" Value="{ext:Loc DiskCleanup.Button.SelectAll}" />
                            <Setter Property="Icon">
                                <Setter.Value>
                                    <ui:SymbolIcon FontSize="18" Symbol="CheckboxChecked24" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ViewModel.IsAllSelected}" Value="True">
                                    <Setter Property="Appearance" Value="Danger" />
                                    <Setter Property="Content" Value="{ext:Loc DiskCleanup.Button.DeselectAll}" />
                                    <Setter Property="Icon">
                                        <Setter.Value>
                                            <ui:SymbolIcon FontSize="18" Symbol="CheckboxUnchecked24" />
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ui:Button.Style>
                </ui:Button>
            </StackPanel>

            <!--  Items list (virtualized)  -->
            <ui:VirtualizingItemsControl Grid.Row="3" ItemsSource="{Binding ViewModel.CleanupItems}">
                <ui:VirtualizingItemsControl.Template>
                    <ControlTemplate TargetType="ItemsControl">
                        <ScrollViewer HorizontalScrollBarVisibility="Disabled">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ui:VirtualizingItemsControl.Template>
                <ui:VirtualizingItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ui:VirtualizingItemsControl.ItemsPanel>
                <ui:VirtualizingItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type cleanup:CleanupItem}">
                        <Border
                            Margin="0,0,0,4"
                            Padding="14"
                            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!--  Checkbox  -->
                                <CheckBox
                                    Grid.Column="0"
                                    Margin="0,0,12,0"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding IsSelected, Mode=TwoWay}" />

                                <!--  Icon with circle background  -->
                                <Border
                                    Grid.Column="1"
                                    Width="38"
                                    Height="38"
                                    Margin="0,0,14,0"
                                    VerticalAlignment="Center"
                                    Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                    CornerRadius="19">
                                    <ui:SymbolIcon
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="20"
                                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                        Symbol="{Binding Icon}" />
                                </Border>

                                <!--  Info  -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                    <ui:TextBlock FontTypography="BodyStrong" Text="{Binding Name}" />
                                    <ui:TextBlock
                                        Margin="0,2,0,0"
                                        Appearance="Disabled"
                                        FontTypography="Body"
                                        Text="{Binding Description}"
                                        TextWrapping="Wrap" />
                                    <ui:TextBlock
                                        Margin="0,2,0,0"
                                        Appearance="Secondary"
                                        FontTypography="Caption"
                                        Text="{Binding Path}"
                                        TextTrimming="CharacterEllipsis" />

                                    <Border
                                        Margin="0,6,0,0"
                                        HorizontalAlignment="Left"
                                        CornerRadius="10">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Visibility" Value="{Binding IsScanned, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                <Setter Property="Padding" Value="8,3" />
                                                <Setter Property="Background" Value="{Binding SizeBytes, Converter={StaticResource SizeToBrushConverter}}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsScanning}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsCleaning}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding FormattedSize}" Value="0 B">
                                                        <Setter Property="Background" Value="Transparent" />
                                                        <Setter Property="Padding" Value="0,3" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Border>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding FormattedSize}" Value="0 B">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <ui:TextBlock
                                                        FontTypography="Caption"
                                                        Foreground="{DynamicResource TextFillColorInverseBrush}"
                                                        Text="{Binding FormattedSize}" />
                                                    <ui:TextBlock
                                                        Margin="6,0,6,0"
                                                        FontTypography="Caption"
                                                        Foreground="{DynamicResource TextFillColorInverseBrush}"
                                                        Opacity="0.8"
                                                        Text="â€¢" />
                                                    <ui:TextBlock
                                                        FontTypography="Caption"
                                                        Foreground="{DynamicResource TextFillColorInverseBrush}"
                                                        Text="{ext:Loc DiskCleanup_FilesCount, {Binding FileCount}}" />
                                                </StackPanel>
                                            </Border>
                                            <Border>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding FormattedSize}" Value="0 B">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <ui:TextBlock
                                                    FontTypography="Caption"
                                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                    Text="{ext:Loc DiskCleanup.EmptySize}" />
                                            </Border>

                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!--  Scanning / Cleaning spinners  -->
                                <StackPanel
                                    Grid.Column="3"
                                    Margin="14,0,0,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center">
                                    <ui:ProgressRing
                                        Width="22"
                                        Height="22"
                                        IsIndeterminate="True"
                                        Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    <ui:ProgressRing
                                        Width="22"
                                        Height="22"
                                        IsIndeterminate="True"
                                        Visibility="{Binding IsCleaning, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ui:VirtualizingItemsControl.ItemTemplate>
            </ui:VirtualizingItemsControl>
        </Grid>
    </Grid>
</Page>