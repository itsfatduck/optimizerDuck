<Page
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Margin="0,32,0,0"
    ScrollViewer.CanContentScroll="False"
    Title="Dashboard"
    d:DesignHeight="650"
    d:DesignWidth="800"
    mc:Ignorable="d"
    ui:Design.Background="Black"
    ui:Design.Foreground="White"
    x:Class="optimizerDuck.UI.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:converters="clr-namespace:optimizerDuck.Common.Helpers.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="clr-namespace:optimizerDuck.Common.Extensions"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:MBToGBConverter x:Key="MBToGBConverter" />
        <converters:GreaterThanNumberToVisibilityConverter Threshold="1" x:Key="GreaterThanOneToVisibilityConverter" />
        <converters:MinusNumberConverter NumberToMinus="1" x:Key="MinusOneConverter" />
        <converters:ThemeToGitHubIconConverter x:Key="ThemeToGitHubIconConverter" />
    </Page.Resources>

    <Grid RowDefinitions="Auto,Auto,*">
        <!--  Loading Overlay  -->
        <Grid
            Grid.RowSpan="3"
            Panel.ZIndex="1000"
            Visibility="{Binding ViewModel.IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="{DynamicResource ApplicationBackgroundBrush}" Opacity="0.8" />
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:ProgressRing
                    Height="60"
                    IsIndeterminate="True"
                    Width="60" />
                <ui:TextBlock
                    FontTypography="Subtitle"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0"
                    Text="{ext:Loc Dashboard.SystemInfo.Loading}"
                    TextWrapping="Wrap" />
            </StackPanel>
        </Grid>

        <!--  Header  -->
        <StackPanel Margin="0,0,0,20">
            <ui:InfoBar
                IsOpen="{Binding ViewModel.IsUpdateInfoOpen, Mode=TwoWay}"
                Margin="0,0,0,10"
                Message="A new version of optimizerDuck is available."
                Severity="Warning"
                Title="Update Available" />
            <Grid ColumnDefinitions="*,Auto">
                <ui:TextBlock
                    FontTypography="Title"
                    Text="{ext:Loc Dashboard.Header.Title}"
                    TextWrapping="Wrap" />

                <Menu Grid.Column="1">
                    <ui:MenuItem Header="{ext:Loc Dashboard.Header.Menu.Header.Options}">
                        <ui:MenuItem Header="{ext:Loc Dashboard.Header.Menu.Header.Run}" Icon="{ui:SymbolIcon Apps24}">
                            <ui:MenuItem
                                Command="{Binding ViewModel.RunCommand}"
                                CommandParameter="Settings"
                                Header="{ext:Loc Dashboard.Header.Menu.RunSettings}" />
                            <ui:MenuItem
                                Command="{Binding ViewModel.RunCommand}"
                                CommandParameter="TaskManager"
                                Header="{ext:Loc Dashboard.Header.Menu.RunTaskManager}" />
                            <ui:MenuItem
                                Command="{Binding ViewModel.RunCommand}"
                                CommandParameter="ControlPanel"
                                Header="{ext:Loc Dashboard.Header.Menu.RunControlPanel}" />
                        </ui:MenuItem>
                        <Separator />
                        <ui:MenuItem
                            Command="{Binding ViewModel.RefreshCommand}"
                            Header="{ext:Loc Dashboard.Header.Menu.Refresh}"
                            Icon="{ui:SymbolIcon ArrowClockwise24}" />
                    </ui:MenuItem>
                </Menu>
            </Grid>
        </StackPanel>

        <!--  Action Cards  -->
        <UniformGrid
            Columns="3"
            Grid.Row="1"
            Margin="0,0,0,20">
            <ui:CardAction
                Command="{Binding ViewModel.OpenActionCommand}"
                CommandParameter="Discord"
                Margin="0,0,5,0"
                VerticalAlignment="Stretch">
                <ui:CardAction.Icon>
                    <ui:ImageIcon Height="25" Source="pack://application:,,,/Resources/Images/DiscordLogo.png" />
                </ui:CardAction.Icon>
                <StackPanel>
                    <ui:TextBlock FontTypography="BodyStrong" Text="{ext:Loc Dashboard.Actions.Discord.Title}" />
                    <ui:TextBlock
                        Appearance="Secondary"
                        FontTypography="Caption"
                        Text="{ext:Loc Dashboard.Actions.Discord.Description}"
                        TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction
                Command="{Binding ViewModel.OpenActionCommand}"
                CommandParameter="GitHub"
                Margin="5,0,5,0"
                VerticalAlignment="Stretch">
                <ui:CardAction.Icon>
                    <ui:ImageIcon Height="40" Source="{Binding ViewModel.CurrentApplicationTheme, Converter={StaticResource ThemeToGitHubIconConverter}}" />
                </ui:CardAction.Icon>
                <StackPanel>
                    <ui:TextBlock FontTypography="BodyStrong" Text="{ext:Loc Dashboard.Actions.GitHub.Title}" />
                    <ui:TextBlock
                        Appearance="Secondary"
                        FontTypography="Caption"
                        Text="{ext:Loc Dashboard.Actions.GitHub.Description}"
                        TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction
                Command="{Binding ViewModel.OpenActionCommand}"
                CommandParameter="Support"
                Icon="{ui:SymbolIcon Heart24,
                                     Filled=True}"
                Margin="5,0,0,0"
                VerticalAlignment="Stretch">
                <StackPanel>
                    <ui:TextBlock FontTypography="BodyStrong" Text="{ext:Loc Dashboard.Actions.SupportMe.Title}" />
                    <ui:TextBlock
                        Appearance="Secondary"
                        FontTypography="Caption"
                        Text="{ext:Loc Dashboard.Actions.SupportMe.Description}"
                        TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>
        </UniformGrid>

        <ScrollViewer
            Grid.Row="2"
            HorizontalScrollBarVisibility="Disabled"
            Padding="20,0"
            VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!--  System Info Cards  -->
                <UniformGrid Columns="2" Rows="2">
                    <!--  Operating System  -->
                    <ui:CardControl
                        Icon="{ui:SymbolIcon Tv24}"
                        Margin="0,0,5,5"
                        VerticalAlignment="Stretch">
                        <ui:CardControl.Header>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0">
                                    <ui:TextBlock FontTypography="BodyStrong" Text="{Binding ViewModel.SystemInfo.Os.Name}" />
                                    <ui:TextBlock Appearance="Secondary" FontTypography="Caption">
                                        <Run Text="{Binding ViewModel.SystemInfo.Os.Edition}" />
                                        <Run Text="·" />
                                        <Run Text="{Binding ViewModel.SystemInfo.Os.Architecture}" />
                                    </ui:TextBlock>
                                </StackPanel>

                                <WrapPanel
                                    Grid.Row="1"
                                    Margin="0,8,0,0"
                                    Orientation="Horizontal">
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption" Text="{Binding ViewModel.SystemInfo.Os.BuildNumber, StringFormat='{}Build {0}'}" />
                                    </Border>
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption" Text="{Binding ViewModel.SystemInfo.Os.DeviceType}" />
                                    </Border>
                                </WrapPanel>
                            </Grid>
                        </ui:CardControl.Header>
                    </ui:CardControl>

                    <!--  CPU  -->
                    <ui:CardControl
                        Icon="{ui:SymbolIcon DeveloperBoard24}"
                        Margin="5,0,0,5"
                        VerticalAlignment="Stretch">
                        <ui:CardControl.Header>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0">
                                    <ui:TextBlock
                                        FontTypography="BodyStrong"
                                        Text="{Binding ViewModel.SystemInfo.Cpu.Name}"
                                        TextTrimming="CharacterEllipsis" />
                                    <ui:TextBlock Appearance="Secondary" FontTypography="Caption">
                                        <Run Text="{Binding ViewModel.SystemInfo.Cpu.Vendor}" />
                                        <Run Text="·" />
                                        <Run Text="{ext:Loc Dashboard.SystemInfo.Cpu.Cores, {Binding ViewModel.SystemInfo.Cpu.Cores}}" />
                                        <Run Text="/" />
                                        <Run Text="{ext:Loc Dashboard.SystemInfo.Cpu.Threads, {Binding ViewModel.SystemInfo.Cpu.Threads}}" />
                                    </ui:TextBlock>
                                </StackPanel>

                                <WrapPanel
                                    Grid.Row="1"
                                    Margin="0,8,0,0"
                                    Orientation="Horizontal">
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="{Binding ViewModel.SystemInfo.Cpu.CurrentClockMHz}" />
                                            <Run Text="MHz" />
                                        </ui:TextBlock>
                                    </Border>
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="L2:" />
                                            <Run Text="{Binding ViewModel.SystemInfo.Cpu.L2CacheKB}" />
                                            <Run Text="KB" />
                                        </ui:TextBlock>
                                    </Border>
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="L3:" />
                                            <Run Text="{Binding ViewModel.SystemInfo.Cpu.L3CacheKB}" />
                                            <Run Text="KB" />
                                        </ui:TextBlock>
                                    </Border>
                                </WrapPanel>
                            </Grid>
                        </ui:CardControl.Header>
                    </ui:CardControl>

                    <!--  RAM  -->
                    <ui:CardControl
                        Icon="{ui:SymbolIcon Memory16}"
                        Margin="0,5,5,0"
                        VerticalAlignment="Stretch">
                        <ui:CardControl.Header>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0">
                                    <ui:TextBlock FontTypography="BodyStrong">
                                        <Run Text="{Binding ViewModel.RuntimeRam.TotalGB, StringFormat='{}{0:F1}'}" />
                                        <Run Text="GB RAM" />
                                    </ui:TextBlock>
                                    <ui:TextBlock Appearance="Secondary" FontTypography="Caption">
                                        <Run Text="{ext:Loc Dashboard.SystemInfo.Ram.Used, {Binding ViewModel.RuntimeRam.UsedGB, StringFormat='{}{0:F1}'}}" />
                                        <Run Text="·" />
                                        <Run Text="{ext:Loc Dashboard.SystemInfo.Ram.Available, {Binding ViewModel.RuntimeRam.AvailableGB, StringFormat='{}{0:F1}'}}" />
                                    </ui:TextBlock>
                                </StackPanel>

                                <ProgressBar
                                    Grid.Row="1"
                                    Height="6"
                                    Margin="0,8,0,0"
                                    Maximum="100"
                                    Value="{Binding ViewModel.RuntimeRam.UsedPercent}" />

                                <WrapPanel
                                    Grid.Row="2"
                                    Margin="0,8,0,0"
                                    Orientation="Horizontal">
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="{ext:Loc Dashboard.SystemInfo.Ram.Modules, {Binding ViewModel.RuntimeRam.Modules.Count, Mode=OneWay}}" />
                                        </ui:TextBlock>
                                    </Border>
                                </WrapPanel>
                            </Grid>
                        </ui:CardControl.Header>
                    </ui:CardControl>

                    <!--  GPU  -->
                    <ui:CardControl
                        Icon="{ui:SymbolIcon NetworkAdapter16}"
                        Margin="5,5,0,0"
                        VerticalAlignment="Stretch">
                        <ui:CardControl.Header>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0">
                                    <ui:TextBlock
                                        FontTypography="BodyStrong"
                                        Text="{Binding ViewModel.SystemInfo.PrimaryGpu.Name}"
                                        TextTrimming="CharacterEllipsis" />
                                    <ui:TextBlock
                                        Appearance="Secondary"
                                        FontTypography="Caption"
                                        Text="{Binding ViewModel.SystemInfo.PrimaryGpu.Vendor}" />
                                </StackPanel>

                                <WrapPanel
                                    Grid.Row="1"
                                    Margin="0,8,0,0"
                                    Orientation="Horizontal">
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="{Binding ViewModel.SystemInfo.PrimaryGpu.MemoryMB, Converter={StaticResource MBToGBConverter}}" />
                                            <Run Text="GB" />
                                        </ui:TextBlock>
                                    </Border>
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3">
                                        <ui:TextBlock
                                            FontTypography="Caption"
                                            Text="{Binding ViewModel.SystemInfo.PrimaryGpu.DriverVersion}"
                                            TextTrimming="CharacterEllipsis" />
                                    </Border>
                                    <Border
                                        Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,4,4"
                                        Padding="6,3"
                                        Visibility="{Binding ViewModel.SystemInfo.Gpus.Count, Converter={StaticResource GreaterThanOneToVisibilityConverter}}">
                                        <ui:TextBlock FontTypography="Caption">
                                            <Run Text="{ext:Loc Dashboard.SystemInfo.Gpu.More, {Binding ViewModel.SystemInfo.Gpus.Count, Mode=OneWay, Converter={StaticResource MinusOneConverter}}}" />
                                        </ui:TextBlock>
                                    </Border>
                                </WrapPanel>
                            </Grid>
                        </ui:CardControl.Header>
                    </ui:CardControl>
                </UniformGrid>

                <!--  Storage Section  -->
                <ui:TextBlock
                    FontTypography="BodyStrong"
                    Margin="0,20,0,8"
                    Text="{ext:Loc Dashboard.SystemInfo.Storage.Header}" />

                <ItemsControl ItemsSource="{Binding ViewModel.SystemInfo.Disk.Volumes}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <ui:CardControl Margin="0,0,0,8">
                                <ui:CardControl.Icon>
                                    <ui:SymbolIcon Filled="True" Symbol="HardDrive20">
                                        <ui:SymbolIcon.Style>
                                            <Style TargetType="ui:SymbolIcon">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SystemDrive}" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorAttentionBrush}" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:SymbolIcon.Style>
                                    </ui:SymbolIcon>
                                </ui:CardControl.Icon>
                                <ui:CardControl.Header>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!--  Drive Letter and Label  -->
                                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                                            <ui:TextBlock
                                                FontTypography="BodyStrong"
                                                Margin="0,0,5,0"
                                                Text="{Binding Letter, StringFormat='({0})'}" />

                                            <ui:TextBlock
                                                FontTypography="Caption"
                                                Margin="0,0,5,0"
                                                Text="{Binding Label}"
                                                VerticalAlignment="Center" />

                                            <Border
                                                Background="{DynamicResource SystemFillColorAttentionBrush}"
                                                CornerRadius="4"
                                                Margin="0,0,4,0"
                                                Padding="5,2"
                                                VerticalAlignment="Center"
                                                Visibility="{Binding SystemDrive, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <ui:TextBlock
                                                    FontTypography="Caption"
                                                    Foreground="Black"
                                                    Text="{ext:Loc Dashboard.SystemInfo.Storage.System}" />
                                            </Border>

                                            <Border
                                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                                CornerRadius="4"
                                                Margin="0,0,4,0"
                                                Padding="5,2"
                                                VerticalAlignment="Center">
                                                <ui:TextBlock FontTypography="Caption" Text="{Binding MediaType}">
                                                    <ui:TextBlock.Style>
                                                        <Style TargetType="ui:TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding MediaType}" Value="SSD">
                                                                    <Setter Property="Foreground" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding MediaType}" Value="HDD">
                                                                    <Setter Property="Foreground" Value="{DynamicResource SystemFillColorCautionBrush}" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ui:TextBlock.Style>
                                                </ui:TextBlock>
                                            </Border>

                                            <Border
                                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                                CornerRadius="4"
                                                Padding="5,2"
                                                VerticalAlignment="Center">
                                                <ui:TextBlock FontTypography="Caption" Text="{Binding FileSystem}" />
                                            </Border>
                                        </StackPanel>

                                        <!--  Model Information  -->
                                        <ui:TextBlock
                                            Appearance="Secondary"
                                            FontTypography="Caption"
                                            Grid.Row="1"
                                            Margin="0,4,0,0"
                                            Text="{Binding Model}"
                                            TextTrimming="CharacterEllipsis"
                                            Visibility="{Binding Model, Converter={StaticResource NullToVisibilityConverter}}" />

                                        <!--  Storage Stats  -->
                                        <StackPanel
                                            Grid.Row="2"
                                            Margin="0,4,0,0"
                                            Orientation="Horizontal">
                                            <ui:TextBlock
                                                Appearance="Secondary"
                                                FontTypography="Caption"
                                                Text="{ext:Loc Dashboard.SystemInfo.Storage.DiskInfo,
                                                               {Binding UsedSpaceGB, StringFormat='{}{0:F1}'},
                                                               {Binding TotalSizeGB, StringFormat='{}{0:F1}'},
                                                               {Binding FreeSpaceGB, StringFormat='{}{0:F1}'}}" />
                                        </StackPanel>

                                        <!--  Progress Bar  -->
                                        <ProgressBar
                                            Grid.Row="3"
                                            Height="6"
                                            Margin="0,8,0,0"
                                            Maximum="100"
                                            Value="{Binding UsedPercent}" />
                                    </Grid>
                                </ui:CardControl.Header>
                            </ui:CardControl>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>