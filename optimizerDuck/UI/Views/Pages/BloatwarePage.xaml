<Page
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Margin="0,32,0,0"
    ScrollViewer.CanContentScroll="False"
    Title="BloatwarePage"
    d:DesignHeight="1200"
    d:DesignWidth="800"
    mc:Ignorable="d"
    ui:Design.Background="Black"
    ui:Design.Foreground="White"
    x:Class="optimizerDuck.UI.Views.Pages.BloatwarePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:bloatware="clr-namespace:optimizerDuck.Core.Models.Bloatware"
    xmlns:converters="clr-namespace:optimizerDuck.Common.Helpers.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="clr-namespace:optimizerDuck.Common.Extensions"
    xmlns:local="clr-namespace:optimizerDuck.UI.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Page.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </Page.Resources>


    <StackPanel>
        <ui:TextBlock
            FontTypography="Title"
            Margin="0,0,0,20"
            Text="{ext:Loc Bloatware.Header.Title}"
            TextWrapping="Wrap" />

        <Border
            Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
            CornerRadius="6"
            Padding="8">
            <ui:VirtualizingItemsControl ItemsSource="{Binding ViewModel.AppxPackages}" ScrollViewer.VerticalScrollBarVisibility="Auto">
                <!--  Layout panel  -->
                <ui:VirtualizingItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ui:VirtualizingItemsControl.ItemsPanel>

                <!--  Item template  -->
                <ui:VirtualizingItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type bloatware:AppxPackage}">
                        <Border
                            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="6"
                            Margin="0,0,0,8"
                            Padding="12">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!--  Checkbox  -->
                                <CheckBox
                                    Grid.Column="0"
                                    IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                    IsEnabled="{Binding NonRemovable, Converter={StaticResource InverseBooleanConverter}}"
                                    Margin="0,4,12,0"
                                    VerticalAlignment="Top" />

                                <!--  Content  -->
                                <StackPanel Grid.Column="1">

                                    <!--  Top row  -->
                                    <DockPanel LastChildFill="False">

                                        <!--  App Name  -->
                                        <ui:TextBlock FontTypography="BodyStrong" Text="{Binding Name}" />

                                        <!--  Version  -->
                                        <ui:TextBlock
                                            Appearance="Tertiary"
                                            FontTypography="Body"
                                            Margin="5,0,0,0"
                                            Text="{Binding Version, StringFormat=' v{0}'}"
                                            VerticalAlignment="Center" />

                                    </DockPanel>

                                    <!--  Publisher  -->
                                    <ui:TextBlock
                                        Appearance="Secondary"
                                        FontTypography="Body"
                                        Margin="0,2,0,0"
                                        Text="{Binding Publisher}"
                                        TextTrimming="CharacterEllipsis" />

                                    <!--  Install info  -->
                                    <ui:TextBlock
                                        Appearance="Tertiary"
                                        FontTypography="Body"
                                        Margin="0,2,0,0">
                                        <Run Text="Installed: " />
                                        <Run Text="{Binding InstallDate, StringFormat='{}{0:yyyy-MM-dd}'}" />
                                    </ui:TextBlock>

                                    <!--  Install location  -->
                                    <ui:TextBlock
                                        Appearance="Disabled"
                                        FontTypography="Body"
                                        Margin="0,2,0,0"
                                        Text="{Binding InstallLocation}"
                                        TextTrimming="CharacterEllipsis" />

                                    <!--  Package full name (technical, nhỏ hơn)  -->
                                    <ui:TextBlock
                                        Appearance="Disabled"
                                        FontTypography="Caption"
                                        Margin="0,4,0,0"
                                        Text="{Binding PackageFullName}"
                                        TextTrimming="CharacterEllipsis" />
                                </StackPanel>

                                <!--  NonRemovable Badge  -->
                                <Border
                                    Background="#AAFF3B30"
                                    CornerRadius="12"
                                    Grid.Column="2"
                                    Padding="8,4"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding NonRemovable, Converter={StaticResource BooleanToVisibilityConverter}}">

                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="SemiBold"
                                        Foreground="White"
                                        Text="System" />
                                </Border>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ui:VirtualizingItemsControl.ItemTemplate>
            </ui:VirtualizingItemsControl>
        </Border>
    </StackPanel>
</Page>
