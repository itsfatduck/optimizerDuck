<Page
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Margin="0,32,0,0"
    ScrollViewer.CanContentScroll="False"
    Title="BloatwarePage"
    d:DataContext="{d:DesignInstance local:BloatwarePage}"
    d:DesignHeight="1200"
    d:DesignWidth="800"
    mc:Ignorable="d"
    ui:Design.Background="Black"
    ui:Design.Foreground="White"
    x:Class="optimizerDuck.UI.Views.Pages.BloatwarePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:bloatware="clr-namespace:optimizerDuck.Core.Models.Bloatware"
    xmlns:converters="clr-namespace:optimizerDuck.Common.Helpers.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="clr-namespace:optimizerDuck.Common.Extensions"
    xmlns:local="clr-namespace:optimizerDuck.UI.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Page.Resources>
        <converters:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter" />
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter" />
    </Page.Resources>

    <Grid RowDefinitions="Auto *">
        <ui:TextBlock
            FontTypography="Title"
            Margin="0,0,0,20"
            Text="{ext:Loc Bloatware.Header.Title}"
            TextWrapping="Wrap" />

        <Border Grid.Row="1" Visibility="{Binding ViewModel.AppxPackages.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:ProgressRing
                    HorizontalAlignment="Center"
                    IsIndeterminate="True"
                    VerticalAlignment="Center" />
                <ui:TextBlock
                    HorizontalAlignment="Center"
                    Text="Getting AppX packages..."
                    VerticalAlignment="Center" />
            </StackPanel>
        </Border>

        <Border
            Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
            CornerRadius="6"
            Grid.Row="1"
            Padding="8"
            Visibility="{Binding ViewModel.AppxPackages.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
            <Grid RowDefinitions="Auto *">
                <Menu>
                    <ui:MenuItem
                        Command="{Binding ViewModel.RemoveSelectedCommand}"
                        Header="{Binding ViewModel.SelectedCount, StringFormat='Remove ({0})'}"
                        Icon="{ui:SymbolIcon Delete24,
                                             FontSize=18}" />
                    <ui:MenuItem
                        Command="{Binding ViewModel.RefreshCommand}"
                        Header="Refresh"
                        Icon="{ui:SymbolIcon ArrowClockwise24,
                                             FontSize=18}" />
                </Menu>
                <ui:VirtualizingItemsControl Grid.Row="1" ItemsSource="{Binding ViewModel.AppxPackages}">
                    <ui:VirtualizingItemsControl.Template>
                        <ControlTemplate TargetType="ItemsControl">
                            <ScrollViewer HorizontalScrollBarVisibility="Disabled">
                                <ItemsPresenter />
                            </ScrollViewer>
                        </ControlTemplate>
                    </ui:VirtualizingItemsControl.Template>
                    <!--  Layout panel  -->
                    <ui:VirtualizingItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ui:VirtualizingItemsControl.ItemsPanel>

                    <!--  Item template  -->
                    <ui:VirtualizingItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type bloatware:AppXPackage}">
                            <Border
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="6"
                                Margin="0,0,0,8"
                                Padding="12">

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Checkbox  -->
                                    <CheckBox
                                        Grid.Column="0"
                                        IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                        Margin="0,4,12,0"
                                        VerticalAlignment="Top" />

                                    <!--  Content  -->
                                    <StackPanel Grid.Column="1">

                                        <!--  Top row  -->
                                        <DockPanel LastChildFill="False">

                                            <!--  App Name  -->
                                            <ui:TextBlock FontTypography="BodyStrong" Text="{Binding Name}" />

                                            <Border
                                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                                CornerRadius="5"
                                                HorizontalAlignment="Left"
                                                Margin="5,0,0,0"
                                                Padding="4,1"
                                                VerticalAlignment="Center">
                                                <!--  Version  -->
                                                <ui:TextBlock
                                                    Appearance="Tertiary"
                                                    FontTypography="Body"
                                                    Text="{Binding Version, StringFormat='v{0}'}"
                                                    VerticalAlignment="Center" />
                                            </Border>

                                            <Border
                                                CornerRadius="5"
                                                HorizontalAlignment="Left"
                                                Margin="5,0,0,0"
                                                Padding="4,2">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Risk}" Value="Caution">
                                                                <Setter Property="Background" Value="{DynamicResource SystemFillColorCautionBrush}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon
                                                        Foreground="{DynamicResource TextFillColorInverseBrush}"
                                                        Margin="0,0,5,0"
                                                        Symbol="{Binding RiskVisual.Icon}" />

                                                    <ui:TextBlock
                                                        FontTypography="Caption"
                                                        Foreground="{DynamicResource TextFillColorInverseBrush}"
                                                        HorizontalAlignment="Center"
                                                        Text="{Binding RiskVisual.Display}"
                                                        TextWrapping="Wrap"
                                                        VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>

                                        </DockPanel>

                                        <!--  Publisher  -->
                                        <ui:TextBlock
                                            Appearance="Secondary"
                                            FontTypography="Body"
                                            Margin="0,2,0,0"
                                            Text="{Binding Publisher}"
                                            TextTrimming="CharacterEllipsis" />

                                        <!--  Install location  -->
                                        <ui:TextBlock
                                            Appearance="Disabled"
                                            FontTypography="Body"
                                            Margin="0,2,0,0"
                                            Text="{Binding InstallLocation}"
                                            TextTrimming="CharacterEllipsis" />

                                        <!--  Package full name (technical, nhỏ hơn)  -->
                                        <ui:TextBlock
                                            Appearance="Disabled"
                                            FontTypography="Caption"
                                            Margin="0,4,0,0"
                                            Text="{Binding PackageFullName}"
                                            TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ui:VirtualizingItemsControl.ItemTemplate>
                </ui:VirtualizingItemsControl>
            </Grid>
        </Border>
    </Grid>
</Page>
